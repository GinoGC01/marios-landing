---
// src/pages/plans/[id].astro
import WhatsApp from '../../components/Icons/WhatsApp.astro';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const plans = [
    {
      id: 'impulse',
      name: 'Impulse',
      tagline: 'Tu Primer Paso',
      price: '$0', // Precio de entrada / MVP
      period: '/ despliegue',
      description: 'Ideal si tenés una idea y querés probar si funciona antes de gastar una fortuna. Es simple: ponemos tu oferta frente a la gente para ver si compran o preguntan.',
      concept: 'No es una página web aburrida, es como un volante digital de alta calidad entregado en la mano de tu cliente ideal. Tiene una sola misión: que te escriban al WhatsApp.',
      painPoints: [
        'Miedo a invertir en una idea sin validación previa.',
        'Clientes perdidos por tiempos de carga lentos.',
        'Baja conversión por dificultad de contacto.'
      ],
      solutions: [
        'Landing de validación rápida con riesgo financiero cero.',
        'Tecnología de carga instantánea (Edge Delivery).',
        'Integración directa de WhatsApp para cierre inmediato.'
      ],
      idealFor: 'Emprendedores, lanzamiento de nuevos servicios, probar si un producto se vende.',
      accentColor: '#00ffff',
      benefits: [
        { label: 'Velocidad', value: 'Como un rayo', desc: 'Abre al instante. No le damos tiempo al cliente de arrepentirse.' },
        { label: 'Claridad', value: 'Sin rodeos', desc: 'Decimos qué vendés y cuánto cuesta. Sin menús complicados.' },
        { label: 'Ahorro', value: 'Riesgo Cero', desc: 'Probás tu negocio en el mundo real sin quemar tus ahorros.' },
        { label: 'Facilidad', value: 'Todo al Celular', desc: 'La gente lo ve, le gusta y te escribe directo a tu WhatsApp.' }
      ],
      modules: [
        { title: 'Página de Venta Única', desc: 'Una sola pantalla, sin distracciones. Como un vendedor que solo habla de lo importante para cerrar la venta.' },
        { title: 'Textos que Convencen', desc: 'Escribimos los títulos y descripciones usando psicología de venta para que el cliente quiera comprar.' },
        { title: 'Botón Directo a WhatsApp', desc: 'Sin formularios aburridos. El cliente hace clic y ya está hablando con vos. Cero fricción.' },
        { title: 'Carga Instantánea', desc: 'Usamos tecnología moderna para que la web vuele. Si es rápida, vendés más. Así de simple.' },
        { title: 'Aparecé en el Mapa', desc: 'Te creamos la ficha de Google para que la gente de tu zona te encuentre rápido.' }
      ],
      roadmap: [
        { phase: '01', title: 'La Idea', desc: 'Nos contás qué vendés y elegimos la mejor forma de decirlo.' },
        { phase: '02', title: 'El Armado', desc: 'Preparamos todo para que se vea increíble y funcione rápido.' },
        { phase: '03', title: 'A la Cancha', desc: 'La publicamos y queda lista para que empieces a recibir mensajes.' }
      ]
    },
    {
      id: 'authority',
      name: 'Authority',
      tagline: 'Tu Oficina Digital',
      price: '$299 USD',
      period: ' + mantenimiento',
      description: 'Para cuando ya tenés un negocio funcionando y querés que te tomen en serio. Hacemos que Google te ame y que tus clientes te vean como el líder de tu rubro.',
      concept: 'Es como tener la oficina más lujosa de la ciudad, abierta las 24 horas. Responde las dudas de tus clientes, muestra tu trabajo y genera confianza automática.',
      painPoints: [
        'Comparación constante por precio bajo.',
        'Dependencia total de publicidad paga (Ads).',
        'Atención al cliente repetitiva y manual.'
      ],
      solutions: [
        'Diseño Premium que justifica honorarios altos.',
        'Estrategia SEO para captar clientes gratis en Google.',
        'Automatización de respuestas y educación del cliente.'
      ],
      idealFor: 'Clínicas, abogados, arquitectos, agencias y negocios que venden servicios caros.',
      accentColor: '#a855f7',
      benefits: [
        { label: 'Prestigio', value: 'Imagen Premium', desc: 'Una web que justifica por qué cobrás lo que cobrás.' },
        { label: 'Google', value: 'Te Encuentran', desc: 'Preparamos todo para aparecer cuando la gente busca tu servicio.' },
        { label: 'Ventas', value: 'Automáticas', desc: 'La web explica y convence por vos, ahorrándote horas de reuniones.' },
        { label: 'Control', value: 'Es Tuya', desc: 'Podés subir noticias o artículos nuevos fácilmente cuando quieras.' }
      ],
      modules: [
        { title: 'Sitio Web Completo', desc: 'Varias secciones (Quiénes somos, Servicios, Contacto) para mostrar la estructura real de tu negocio.' },
        { title: 'Blog de Novedades', desc: 'Un espacio para que escribas artículos. Esto le demuestra a Google (y a tus clientes) que sabés de lo que hablás.' },
        { title: 'Traductor para Google', desc: 'Configuramos la web internamente para que Google entienda exactamente qué hacés y te recomiende.' },
        { title: 'Formularios Inteligentes', desc: 'Preguntamos lo necesario antes de que te contacten, así solo hablás con clientes interesados de verdad.' },
        { title: 'Seguimiento de Visitas', desc: 'Instalamos "cámaras" digitales para saber cuánta gente entra y qué miran.' }
      ],
      roadmap: [
        { phase: '01', title: 'Estrategia', desc: 'Miramos qué hace tu competencia para hacer que vos te veas mejor.' },
        { phase: '02', title: 'Diseño', desc: 'Creamos una estructura visual que inspire confianza y calidad.' },
        { phase: '03', title: 'Lanzamiento', desc: 'La subimos a internet y le avisamos a Google que existís.' }
      ]
    },
    {
      id: 'titan',
      name: 'Titan',
      tagline: 'Tu Propia Fábrica',
      price: '$1200 USD',
      period: ' inversión base',
      description: 'Cuando las herramientas normales te quedan chicas. Creamos un sistema a medida para tu empresa que hace el trabajo pesado, organiza tus datos y automatiza tareas.',
      concept: 'Dejás de alquilar software y pasás a ser dueño de tu propia tecnología. Es construir una máquina que trabaja exactamente como vos querés, sin límites.',
      painPoints: [
        'Desorden administrativo y datos en Excels sueltos.',
        'Costos elevados en suscripciones de software (SaaS).',
        'Tareas manuales que frenan la escalabilidad.'
      ],
      solutions: [
        'Centralización de datos en sistema propio.',
        'Propiedad total del código (Activo de empresa).',
        'Automatización de procesos a medida.'
      ],
      idealFor: 'Empresas grandes, startups, e-commerce especiales y negocios con procesos complejos.',
      accentColor: '#eab308',
      benefits: [
        { label: 'Propiedad', value: 'Es Tuyo', desc: 'El sistema es un activo de tu empresa. Sin pagos mensuales por usuario.' },
        { label: 'Orden', value: 'Todo Centralizado', desc: 'Clientes, ventas y procesos en un solo lugar, accesible desde cualquier lado.' },
        { label: 'Ahorro', value: 'Automatización', desc: 'El sistema hace en segundos lo que a un empleado le lleva horas.' },
        { label: 'Seguridad', value: 'Blindado', desc: 'Tus datos están protegidos con los estándares más altos.' }
      ],
      modules: [
        { title: 'Sistema a Medida', desc: 'Programamos el software desde cero para que haga exactamente lo que tu negocio necesita, ni más ni menos.' },
        { title: 'Base de Datos Propia', desc: 'Un archivo digital infinito y ultra rápido para guardar todos tus clientes, pedidos e historial.' },
        { title: 'Panel de Control (Dashboard)', desc: 'Una pantalla donde ves los números de tu negocio en tiempo real (ventas, usuarios, alertas).' },
        { title: 'Cuentas de Usuario', desc: 'Creas accesos para tus empleados, cada uno con permisos para ver solo lo que corresponde.' },
        { title: 'Conexión con Inteligencia Artificial', desc: 'Podemos conectar el sistema a IAs para que redacten correos o analicen datos por vos.' }
      ],
      roadmap: [
        { phase: '01', title: 'El Plano', desc: 'Nos sentamos a entender tu negocio y dibujamos cómo va a funcionar el sistema.' },
        { phase: '02', title: 'La Construcción', desc: 'Programamos el sistema por partes y te lo vamos mostrando para que lo apruebes.' },
        { phase: '03', title: 'La Entrega', desc: 'Lo instalamos, lo probamos a fondo y te enseñamos a usarlo.' }
      ]
    }
  ];

  return plans.map(plan => ({
    params: { id: plan.id },
    props: { plan }
  }));
}

const { plan } = Astro.props;
const WHATSAPP_NUMBER = "5491140230671";
const waMessage = encodeURIComponent(
  `Hola, estuve analizando la especificación técnica del plan ${plan.name} y quiero evaluar su implementación.`
);

// Función para convertir hex a rgb
const hexToRgb = (hex:string ) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result
    ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}`
    : '255, 255, 255';
};

const rgbAccent = hexToRgb(plan.accentColor);
---

<Layout title={`Spec: ${plan.name} | Ingeniería Digital`}>
  
  <section class="min-h-screen pb-32 font-sans selection:bg-[var(--accent)] selection:text-black" style={`--accent-rgb:${rgbAccent}; --accent:${plan.accentColor};`}>
    
    {/* NAVBAR FLOTANTE */}
    <nav class="fixed top-0 left-0 w-full z-50 px-4 py-4 pointer-events-none animate-entry" style="transition-delay: 100ms;">
      <div class="max-w-6xl mx-auto flex justify-between items-center">
        <a href="/plans" class="pointer-events-auto bg-black/60 backdrop-blur-md border border-white/10 rounded-full p-3 text-white hover:bg-white/10 transition-all active:scale-95 group shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:-translate-x-1 transition-transform"><path d="m15 18-6-6 6-6"/></svg>
        </a>
        <div class="pointer-events-auto px-4 py-1.5 rounded-full bg-black/60 backdrop-blur-md border border-[rgba(var(--accent-rgb),0.3)] text-[10px] font-mono font-bold uppercase tracking-widest text-[var(--accent)] shadow-[0_0_15px_rgba(var(--accent-rgb),0.2)]">
          System Spec: {plan.id.toUpperCase()}
        </div>
      </div>
    </nav>

    {/* BACKGROUND GLOW */}
    <div class="absolute inset-0 pointer-events-none bg-radial-at-c opacity-30 transition-transform duration-200 ease-out" aria-hidden="true"></div>


    {/* HERO SECTION */}
    <header class="relative z-10 pt-28 px-5 container mx-auto max-w-5xl">
      <div class="animate-entry inline-flex items-center gap-2 mb-4 px-3 py-1 rounded border bg-[rgba(var(--accent-rgb),0.05)] border-[rgba(var(--accent-rgb),0.2)]" style="transition-delay: 200ms;">
        <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-[var(--accent)]"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-[var(--accent)]"></span>
        </span>
        <span class="text-[var(--accent)] uppercase tracking-[0.2em] text-[10px] font-bold font-mono">
            {plan.tagline}
        </span>
      </div>

      <h1 class="animate-entry text-5xl md:text-7xl font-black text-white leading-[0.9] tracking-tight font-zalando mb-6" style="transition-delay: 300ms;">
        {plan.name.toUpperCase()}
      </h1>

      <p class="animate-entry text-lg md:text-xl text-gray-300 max-w-2xl font-light leading-relaxed mb-8" style="transition-delay: 400ms;">
        {plan.description}
      </p>

      {/* TERMINAL SECTION: Diagnóstico y Solución */}
      <div class="animate-entry w-full mt-12 mx-auto md:mx-0" style="transition-delay: 500ms;">
        <div class="terminal-window bg-[#0c0c0c] border border-white/10 rounded-xl overflow-hidden font-mono text-xs md:text-sm shadow-2xl relative group">
            
            {/* Terminal Header */}
            <div class="bg-[#1a1a1f] p-3 flex items-center gap-2 border-b border-white/5">
                <div class="flex gap-1.5">
                    <div class="w-3 h-3 rounded-full bg-red-500/50 group-hover:bg-red-500 transition-colors"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500/50 group-hover:bg-yellow-500 transition-colors"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500/50 group-hover:bg-green-500 transition-colors"></div>
                </div>
                <div class="ml-4 text-gray-600 text-[10px] tracking-wide flex-1 text-center font-bold">root@server: ~</div>
            </div>

            {/* Terminal Body */}
            <div class="p-6 min-h-[300px] text-gray-300 relative" id="terminal-content">
                
                {/* Paso 1: Diagnóstico */}
                <div class="terminal-step hidden" data-delay="500">
                    <span class="text-[var(--accent)]">root@server:~$</span> <span class="typing-effect">npm run diagnostics</span>
                </div>
                
                <div class="mt-2 space-y-1 mb-6">
                    {plan.painPoints.map((point, i) => (
                        <div class="terminal-step hidden flex gap-2" data-delay={1500 + (i * 500)}>
                            <span class="text-red-500 font-bold shrink-0">[ERROR]</span>
                            <span class="text-gray-400">{point}</span>
                        </div>
                    ))}
                    <div class="terminal-step hidden text-red-500 mt-2 font-bold" data-delay={3500}>
                        &gt; CRITICAL FAILURE DETECTED. ACTION REQUIRED.
                    </div>
                </div>

                {/* Paso 2: Solución */}
                <div class="terminal-step hidden mt-4" data-delay={4500}>
                    <span class="text-[var(--accent)]">root@server:~$</span> <span class="typing-effect">sudo fix --all</span>
                </div>

                <div class="mt-2 space-y-1">
                    {plan.solutions.map((sol, i) => (
                        <div class="terminal-step hidden flex gap-2" data-delay={5500 + (i * 500)}>
                            <span class="text-green-500 font-bold shrink-0">[SUCCESS]</span>
                            <span class="text-white">{sol}</span>
                        </div>
                    ))}
                    <div class="terminal-step hidden text-green-500 mt-2 font-bold" data-delay={7500}>
                        &gt; SYSTEM OPTIMIZED. READY FOR DEPLOY.
                    </div>
                </div>

                {/* Cursor */}
                <div class="mt-4 flex gap-1">
                    <span class="text-[var(--accent)]">root@server:~$</span>
                    <span class="w-2 h-5 bg-gray-500 animate-pulse"></span>
                </div>

            </div>

            {/* Scanline Effect */}
            <div class="absolute inset-0 pointer-events-none bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-20 bg-[length:100%_2px,3px_100%] opacity-20"></div>
        </div>
      </div>
    </header>

    <main class="relative z-10 container mx-auto px-5 mt-20 space-y-24 max-w-5xl">
      
      {/* BENEFICIOS (Dashboard Grid) */}
      <section>
        <div class="animate-entry flex items-center gap-2 mb-6 opacity-80">
            <svg class="w-5 h-5 text-[var(--accent)]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
            <h2 class="text-white font-bold text-lg font-zalando">Métricas de Impacto</h2>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
          {plan.benefits.map((b, index) => (
            <div 
                class="animate-entry group relative bg-[#0a0a0f] border border-white/5 rounded-2xl p-4 hover:border-[rgba(var(--accent-rgb),0.3)] transition-colors duration-300 overflow-hidden"
                style={`transition-delay: ${index * 100}ms;`}
            >
              <div class="absolute inset-0 bg-[var(--accent)] opacity-0 group-hover:opacity-[0.03] transition-opacity"></div>
              <span class="text-[10px] uppercase tracking-wider text-gray-500 font-mono font-bold block mb-2">{b.label}</span>
              <h3 class="text-white font-bold text-base md:text-lg leading-tight mb-1">{b.value}</h3>
              <p class="text-[10px] md:text-xs text-gray-500 leading-tight">{b.desc}</p>
            </div>
          ))}
        </div>
      </section>

      {/* QUÉ INCLUYE (Tech Stack Style) */}
      <section class="animate-entry bg-gradient-to-b from-white/[0.02] to-transparent rounded-3xl p-1 border border-white/5">
        <div class="bg-[#050505] rounded-[1.4rem] p-6 md:p-8">
            <h2 class="text-xs uppercase tracking-[0.2em] text-gray-500 mb-8 font-mono border-b border-white/5 pb-4">
                Especificaciones Técnicas
            </h2>

            <ul class="grid md:grid-cols-2 gap-y-6 gap-x-8">
            {plan.modules.map((m, index) => (
                <li 
                    class="animate-entry flex items-start gap-3 group"
                    style={`transition-delay: ${index * 100}ms;`}
                >
                  <div class="w-5 h-5 mt-1 rounded bg-[rgba(var(--accent-rgb),0.1)] flex items-center justify-center text-[var(--accent)] border border-[rgba(var(--accent-rgb),0.2)] shrink-0">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6 9 17 4 12"/></svg>
                  </div>
                  <div>
                    <h4 class="text-white font-bold text-sm mb-1 group-hover:text-[var(--accent)] transition-colors">{m.title}</h4>
                    <p class="text-xs text-gray-400 leading-relaxed">{m.desc}</p>
                  </div>
                </li>
            ))}
            </ul>
        </div>
      </section>

      {/* ROADMAP (Git Commit Style) */}
      <section>
        <h2 class="animate-entry text-white font-bold text-lg font-zalando mb-10 flex items-center gap-2">
            <span class="text-[var(--accent)]">//</span> Protocolo de Ejecución
        </h2>

        <div class="relative border-l border-white/10 ml-3 md:ml-4 space-y-10 pb-4">
          {plan.roadmap.map((step, index) => (
            <div 
                class="animate-entry relative pl-8 group"
                style={`transition-delay: ${index * 150}ms;`}
            >
              {/* Timeline Node */}
              <div class="absolute -left-[5px] top-1.5 w-2.5 h-2.5 rounded-full bg-[#050505] border border-gray-600 group-hover:border-[var(--accent)] group-hover:scale-125 transition-all z-10 shadow-[0_0_10px_rgba(0,0,0,1)]"></div>
              {/* Active Line Segment */}
              <div class="absolute -left-[1px] top-4 h-full w-[1px] bg-gradient-to-b from-[var(--accent)] to-transparent opacity-0 group-hover:opacity-50 transition-opacity"></div>
              
              <span class="text-[10px] text-[var(--accent)] font-mono font-bold uppercase tracking-widest mb-1 block opacity-80">
                {step.phase}
              </span>
              <h3 class="text-white font-bold text-lg mb-2">
                {step.title}
              </h3>
              <p class="text-sm text-gray-400 max-w-md leading-relaxed">
                {step.desc}
              </p>
            </div>
          ))}
        </div>
      </section>
    </main>

    {/* CTA (Glassmorphic Sticky Bar) */}
    <div class="animate-entry fixed bottom-0 left-0 right-0 p-4 z-40 bg-gradient-to-t from-black via-black/90 to-transparent pt-12" style="transition-delay: 800ms;">
      <div class="max-w-4xl mx-auto bg-[#121212]/80 backdrop-blur-xl border border-white/10 rounded-2xl p-2 pl-5 flex justify-between items-center shadow-2xl shadow-black">
        
        <div class="flex flex-col">
          <span class="text-[9px] md:text-[17px] text-gray-500 uppercase font-bold tracking-wider">Valor de Inversión</span>
          <div class="flex items-baseline gap-1">
            <span class="text-white font-bold text-lg md:text-xl">{plan.price}</span>
            <span class="text-[9px] text-gray-500 font-medium md:text-[12px]">{plan.period}</span>
          </div>
        </div>

        <a
          href={`https://wa.me/${WHATSAPP_NUMBER}?text=${waMessage}`}
          target="_blank"
          class="px-5 py-3 rounded-xl font-bold text-black text-xs md:text-sm shadow-lg hover:brightness-110 active:scale-95 transition-all flex items-center gap-2"
          style={`background:${plan.accentColor}; box-shadow: 0 0 20px rgba(${rgbAccent}, 0.2)`}
        >
          <span>INICIAR AHORA</span>
          <WhatsApp color={'black'}>
        </a>
      </div>
    </div>

  </section>
</Layout>

<style>
  .font-zalando {
    font-family: system-ui, -apple-system, sans-serif;
  }
  
  /* ESTILOS DE ANIMACIÓN ENTRADA */
  .animate-entry {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    will-change: opacity, transform;
  }
  
  .animate-entry.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Efecto de parpadeo suave para el texto de la terminal */
  .fade-in-line {
      animation: fadeIn 0.3s ease-out forwards;
  }
  
  @keyframes fadeIn {
      from { opacity: 0; transform: translateY(2px); }
      to { opacity: 1; transform: translateY(0); }
  }
</style>

<script>
    // Lógica para animar la terminal
    function runTerminalAnimation() {
        const terminal = document.getElementById('terminal-content');
        if (!terminal) return;

        const steps = terminal.querySelectorAll('.terminal-step');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    steps.forEach(step => {
                        const delay = parseInt(step.getAttribute('data-delay') || '0');
                        setTimeout(() => {
                            step.classList.remove('hidden');
                            step.classList.add('fade-in-line');
                        }, delay);
                    });
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.2 });

        observer.observe(terminal);
    }

    // Lógica para animaciones de entrada generales
    function initScrollAnimations() {
        const elements = document.querySelectorAll('.animate-entry');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });

        elements.forEach(el => observer.observe(el));
    }

    // Ejecutar al cargar y en navegaciones de Astro
    document.addEventListener('DOMContentLoaded', () => {
        runTerminalAnimation();
        initScrollAnimations();
    });
    
    document.addEventListener('astro:page-load', () => {
        runTerminalAnimation();
        initScrollAnimations();
    });
</script>